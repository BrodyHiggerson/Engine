#include "lib.esh"

struct View
{ 
	float4x4 view_;
	float4x4 proj_;
};

struct Object
{
	float4x4 world_;	
};

cbuffer ObjectCBuffer
{
	Object o_;
};

cbuffer ViewCBuffer
{
	View v_;
};

SamplerState SS_DEFAULT =
{
	.AddressU = WRAP,
	.AddressV = CLAMP,
	.AddressW = MIRROR,	
};
Texture2D tex_diffuse;

struct VS_IN
{
	float4 position : POSITION; // comment test.
	float2 uv: TEXCOORD0;
}; /* comment test 2 */

struct VS_OUT
{
	float4 position : SV_POSITION;
	float2 uv : TEXCOORD0;
};

VS_OUT vs_main(in VS_IN _in)
{
	VS_OUT _out = (VS_OUT)0;
	_out.position = _in.position;
	_out.uv = _in.uv;
	return _out;
}

float4 ps_debug(in VS_OUT _in) : SV_TARGET0
{
	return float4(fmod(_in.position.x, 1.0), fmod(_in.position.y, 1.0), 1.0, 1.0);
}

float4 ps_main(in VS_OUT _in) : SV_TARGET0
{
	return tex_diffuse.Sample(SS_DEFAULT, _in.uv.xy) * float4(1.0, 1.0, 1.0, 1.0);
}

float4 ps_shadow(in VS_OUT _in) : SV_TARGET0
{
	return float4(1.0, 0.0, 1.0, 1.0);
}

RenderState RS_DEFAULT =
{
	.BlendStates = {
		.Enable = 1,
		.SrcBlend = SRC_COLOR,
	},

	.StencilFront = {

	},

	.StencilBack = {

	},

	.DepthEnable = 1,
	.FillMode = SOLID,
};

Technique TECH_DEBUG =
{
	.VertexShader = vs_main,
	.PixelShader = ps_debug,
	.RenderState = RS_DEFAULT,
};

Technique TECH_MAIN =
{
	.VertexShader = vs_main,
	.PixelShader = ps_main,
	.RenderState = RS_DEFAULT,
};

Technique TECH_SHADOW =
{
	.VertexShader = vs_main,
	.PixelShader = ps_shadow,
	.RenderState = RS_DEFAULT,
};
